<!DOCTYPE html>
@{
    //ViewBag.Title = "登录";
    Layout = null;
}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>登录</title>
    <link href="/Content/login/css/style.css" rel="stylesheet" />
    <link href="/Content/login/css/iconfont.css" rel="stylesheet" />   
    <link href="~/Content/layui/css/modules/layer/default/layer.css" rel="stylesheet" />
</head>
<body>
    <div class="login-banner"></div>
    <div class="login-box">
        <div class="box-con tran">
            <!-- 登录 开始-->
            <div class="login-con f-l">
                <div class="form-group">
                    <input type="text" placeholder="手机号码" id="LoginName" />
                    <span class="error-notic">手机号码不正确</span>
                </div>
                <div class="form-group">
                    <input type="password" placeholder="密码" id="LoginPwd">
                    <span class="error-notic">密码不正确</span>
                </div>
                <div class="form-group">
                    <button type="submit" class="tran pr">
                        <a href="javascript:loginin()" class="tran">登录</a>
                        @*<img class="loading" src="/Content/login/images/loading.gif" style="display:block">*@
                    </button>
                </div>
                <div class="from-line"></div>
                <div class="form-group">
                    <a href="javascript:;" class="move-signup a-tag tran blue-border">还没有帐号？免费注册<i class="iconfont tran">&#xe606;</i></a>
                </div>
                <div class="form-group">
                    <a href="javascript:;" class="move-reset a-tag tran">忘记密码？重置 <i class="iconfont tran">&#xe606;</i></a>
                </div>
                <div class="form-group">
                    <a href="/Home/Index/" class="move-other a-tag tran  blue-border">返回首页<i class="iconfont tran">&#xe606;</i></a>
                </div>
            </div>
            <!-- 登录 结束-->

            <!-- 手机号码注册 -->
            <div class="signup f-l">
                <div class="form-group">
                    <div class="signup-form">
                        <input type="text" id="txtPhone" placeholder="手机号码" class="email-mobile" onblur="verify.verifyMobile(this)">
                        <a href="javascript:;" class="signup-select">手机注册</a>
                    </div>
                    <span class="error-notic">手机格式不正确</span>
                </div>
                <div class="signup-tel">
                    <div class="signup-form" id="message-inf">
                        <input type="text" id="txtValidCode" placeholder="短信验证码" style="width:180px;">@*onblur="verify.VerifyCount(this)"*@
                        <a href="javascript:SendPhone('注册');" id="btnSendVerify" class="reacquire">获取验证码</a>
                        @*<span class="error-notic">验证码输入错误</span>*@
                    </div>
                    <div class="form-group">
                        <input type="text" placeholder="您的昵称" id="txtNick" onblur="verify.VerifyNick(this)">
                        <span class="error-notic">请输入你的昵称</span>
                    </div>
                    <div class="form-group">
                        <input type="password" id="newpwd" placeholder="密码（字母、数字，至少6位）" onblur="verify.PasswordLenght(this)">
                        <span class="error-notic">密码长度不够</span>
                    </div>
                    <div class="form-group">
                        <input type="password" id="checkedpwd" placeholder="确认密码" onblur="verify.CheckPassword(this)">@**@
                        <span class="error-notic">确认密码不一致</span>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="tran pr">
                            <a href="javascript:registerin();" class="tran">注册</a>
                            <img class="loading" src="/Content/login/images/loading.gif">
                        </button>
                    </div>
                    <p class="view-clause">点击注册，即同意我们的 <a href="javascript:GetTerms();">用户隐私条款</a></p>
                </div>
                <!-- 手机注册 -->


                <div class="from-line"></div>
                <div class="form-group">
                    <a href="javascript:;" class="move-login a-tag tran blue-border">已有帐号？登录<i class="iconfont tran">&#xe606;</i></a>
                </div>
                <div class="form-group">
                    <a href="/Home/Index/" class="move-other a-tag tran blue-border">返回首页<i class="iconfont tran">&#xe606;</i></a>
                </div>
            </div>

            <!-- 注册 结束-->
            <!-- 第三方登录 -->
            <div class="other-way f-l">
                <div class="form-group">
                    <button type="submit" class="tran pr">
                        <a href="javascript:;" class="tran">QQ帐号登录</a>
                        <img class="loading" src="/Content/login/images/loading.gif">
                    </button>
                </div>
                <div class="form-group">
                    <button type="submit" class="tran pr">
                        <a href="javascript:;" class="tran">新浪微博帐号登录</a>
                        <img class="loading" src="/Content/login/images/loading.gif">
                    </button>
                </div>
                <div class="form-group">
                    <button type="submit" class="tran pr">
                        <a href="javascript:;" class="tran">微信帐号登录</a>
                        <img class="loading" src="/Content/login/images/loading.gif">
                    </button>
                </div>
                <div class="form-group">
                    <button type="submit" class="tran pr">
                        <a href="javascript:;" class="tran">网易帐号登录</a>
                        <img class="loading" src="/Content/login/images/loading.gif">
                    </button>
                </div>
                <div class="from-line"></div>
                <div class="form-group">
                    <a href="javascript:;" class="move-signup a-tag tran blue-border">还没有帐号？免费注册<i class="iconfont tran">&#xe606;</i></a>
                </div>
                <div class="form-group">
                    <a href="javascript:;" class="move-login a-tag tran">已有帐号？登录<i class="iconfont tran">&#xe606;</i></a>
                </div>
            </div>

            <!-- 第三方登录 -->
            <!--密码重置 开始-->
            <div class="mimachongzhi f-l">
                <div class="form-group">
                    <input type="text" id="txtTel" placeholder="请输入您的手机号码" onblur="verify.verifyMobile(this)">
                    <span class="error-notic">手机格式不正确</span>
                </div>
                <div class="form-group">
                    <div class="signup-form" id="message-inf">
                        <input type="text" id="txtCodePwd" placeholder="手机验证码" style="width:180px;">@*onblur="verify.VerifyCount(this)"*@
                        <a href="javascript:SendPhone('重置密码');" id="btnSendVerify_pwd" class="reacquire">获取验证码</a>
                        @*<span class="error-notic">验证码输入错误</span>*@
                    </div>
                    <div class="form-group">
                        <input type="password" id="Setpwd" placeholder="重置密码（字母、数字，至少6位）" onblur="verify.PasswordLenght(this)">
                        <span class="error-notic">密码长度不够</span>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="tran pr">
                            <a href="javascript:resetpwd();" class="tran">密码重置</a>
                            <img class="loading" src="/Content/login/images/loading.gif">
                        </button>
                    </div>

                </div>
                <div class="from-line"></div>
                <div class="form-group">
                    <a href="javascript:;" class="move-signup	a-tag tran blue-border">还没有帐号？免费注册<i class="iconfont tran">&#xe606;</i></a>
                </div>
                <div class="form-group">
                    <a href="javascript:;" class="move-login a-tag tran">已有帐号？登录<i class="iconfont tran">&#xe606;</i></a>
                </div>
                <div class="form-group">
                    <a href="/Home/Index/" class="move-other a-tag tran blue-border">返回首页<i class="iconfont tran">&#xe606;</i></a>
                </div>
            </div>
            <!-- 密码重置 -->


            @*<div class="mobile-success f-l">
                <p>手机号 <span>186****7580</span> 验证成功</p>
                <p>请完善您的账号信息，您也可以<a href="#">绑定现有账号</a></p>
                <div class="form-group">
                    <input type="text" placeholder="邮箱" class="email-mobile" onblur="verify.verifyEmail(this)" />
                    <span class="error-notic">邮箱格式不正确</span>
                </div>
                <div class="form-group">
                    <input type="text" placeholder="您的名字">
                </div>
                <div class="form-group">
                    <input type="password" placeholder="密码（字母、数字，至少6位）" onblur="verify.PasswordLenght(this)" />
                    <span class="error-notic">密码长度不够</span>
                </div>
                <div class="form-group">
                    <button type="submit" class="tran pr">
                        <a href="javascript:;" class="tran">注册</a>
                        <img class="loading" src="/Content/login/images/loading.gif">
                    </button>
                </div>
                <p class="view-clause">点击注册，即同意我们的 <a href="#">用户隐私条款</a></p>
            </div>*@

            <!-- 手机注册成功添补信息 -->

        </div>

    </div>


    <script src="/Scripts/jquery-1.10.2.min.js"></script>
    <script src="/Content/login/js/jquery.js"></script>
    <script src="/Content/layui/lay/modules/layer.js"></script>
    <script type="text/javascript">
        var _handle = '';//储存电话是否填写正确
        var msg ="@(ViewBag.msg)";

        $(function () {

            $(".signup-form input").on("focus", function () {
                $(this).parent().addClass("border");
            });
            $(".signup-form input").on("blur", function () {
                $(this).parent().removeClass("border");
            })

            //注册方式切换

            //$(".signup-select").on("click", function () {
            //    var _text = $(this).text();
            //    var $_input = $(this).prev();
            //    $_input.val('');
            //    if (_text == "手机注册") {
            //        $(".signup-tel").fadeIn(200);
            //        $(".signup-email").fadeOut(180);
            //        $(this).text("邮箱注册");
            //        $_input.attr("placeholder", "手机号码");
            //        $_input.attr("onblur", "verify.verifyMobile(this)");
            //        $(this).parents(".form-group").find(".error-notic").text("手机号码格式不正确")

            //    }

            //    if (_text == "邮箱注册") {
            //        $(".signup-tel").fadeOut(180);
            //        $(".signup-email").fadeIn(200);
            //        $(this).text("手机注册");
            //        $_input.attr("placeholder", "邮箱");
            //        $_input.attr("onblur", "verify.verifyEmail(this)");
            //        $(this).parents(".form-group").find(".error-notic").text("邮箱格式不正确")

            //    }

            //});

            //步骤切换

            var _boxCon = $(".box-con");
            $(".move-login").on("click", function () {
                $(_boxCon).css({
                    'marginLeft': 0
                })
            });
            $(".move-signup").on("click", function () {
                $(_boxCon).css({
                    'marginLeft': -320
                })
            });

            $(".move-other").on("click", function () {
                $(_boxCon).css({
                    'marginLeft': -640
                })
            });

            $(".move-reset").on("click", function () {
                $(_boxCon).css({
                    'marginLeft': -960
                })
            });

            $("body").on("click", ".move-addinf", function () {
                $(_boxCon).css({
                    'marginLeft': -1280
                })
            });



            //获取短信验证码
            var messageVerify = function () {
                $(".get-message").on("click", function () {
                    if (_handle) {
                        $("#message-inf").fadeIn(100)
                        $(this).html('<a href="javascript:;">下一步</a><img class="loading" src="/Content/login/images/loading.gif">').addClass("move-addinf");
                    }

                });

            }();

            //区别注册、登录
            if (msg == 2) {

                $(_boxCon).css({
                    'marginLeft': -320
                })
            }

        });



        //表单验证

        function showNotic(_this) {
            $(_this).parents(".form-group").find(".error-notic").fadeIn(100);
            //$(_this).focus();

        }//错误提示显示

        function hideNotic(_this) {
            $(_this).parents(".form-group").find(".error-notic").fadeOut(100);

        }//错误提示隐藏

        var verify = {
            verifyEmail: function (_this) {
                var validateReg = new RegExp("^([a-zA-Z0-9_\.\-])+\@@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$");
                var _value = $(_this).val();
                if (!validateReg.test(_value)) {
                    showNotic(_this)
                } else {
                    hideNotic(_this)
                }

            },//验证邮箱

            verifyMobile: function (_this) {
                var validateReg = /^((\+?86)|(\(\+86\)))?1(3|4|5|7|8)\d{9}$/;
                var _value = $(_this).val();
                if (!validateReg.test(_value)) {
                    showNotic(_this);
                    _handle = false;
                } else {
                    hideNotic(_this);
                    _handle = true;
                }
                return _handle

            },//验证手机号码

            PasswordLenght: function (_this) {
                var _length = $(_this).val().length;
                if (_length < 6) {
                    showNotic(_this)
                } else {
                    hideNotic(_this)
                }

            },//验证设置密码长度
            CheckPassword: function (_this) {
                var _value = $(_this).val();
                var _pwd = $("#newpwd").val();
                if (_value != _pwd) {
                    showNotic(_this)
                } else {
                    hideNotic(_this)
                }
            },
            VerifyNick: function (_this) {
                var _value = $(_this).val();
                if (_value == "" || _value == null) {
                    showNotic(_this)
                } else {
                    hideNotic(_this)
                }
            },
            VerifyCount: function (_this) {
                var _count = "123456";
                var _value = $(_this).val();
                //console.log(_value)
                if (_value != _count) {
                    showNotic(_this)
                } else {
                    hideNotic(_this)
                }

            }//验证验证码

        }
        //登录按钮
        function loginin() {

            hideNotic($("#LoginName"));
            hideNotic($("#LoginPwd"));
            var LoginName = $("#LoginName").val();
            var LoginPwd = $("#LoginPwd").val();
            //判空
            if (LoginName == "" || LoginName == null) {
                //showNotic($("#LoginName"))
                $("#LoginName").parents(".form-group").find(".error-notic").text("邮箱或手机号码不能为空");
                showNotic($("#LoginName"))
            }
            if (LoginPwd == "" || LoginPwd == null) {
                //showNotic($("#LoginName"))
                $("#LoginPwd").parents(".form-group").find(".error-notic").text("密码不能为空");
                showNotic($("#LoginPwd"))
            }
            //登录数据交互
            $.ajax({
                type: "POST",
                url: "/Home/LoginIn",
                data: {
                    "AdminID": LoginName,
                    "AdminPwd": LoginPwd
                },
                dataType: "json",
                success: function (jsonData) {

                    if (jsonData.Statu == 1) {
                        location.href = jsonData.BackUrl;
                    } else {
                        layer.alert(jsonData.Msg, { skin: 'layui-layer-lan' });
                    }
                }
            });
        }

        //发送手机证码
        var sendVerifyNum = 0;
        //发送手机证码
        function SendPhone(_that) {
            if (_that == "重置密码") {
                //手机验证           
                var Phone = $.trim($("#txtTel").val());
                if (Phone == null || Phone == "" || Phone == undefined) {
                    layer.alert('手机号码不能为空！', { icon: 2 });
                    //$("#txtTel").focus();
                    return;
                }
                if (sendVerifyNum == 0) {
                    $.ajax({
                        type: "POST",
                        url: "/Home/ResetPhoneCode",
                        data: {
                            "phone": Phone
                        },
                        dataType: "json",
                        success: function (jsonData) {
                            if (jsonData.Statu == 1) {
                                $("#btnSendVerify_pwd").disabled = "disabled";
                                sendVerifyNum = 59;
                                var that = this;
                                //计时器
                                that.timer = setInterval(function () {
                                    sendVerifyNum--;
                                    $("#btnSendVerify_pwd").html("( " + sendVerifyNum + " )");
                                    if (sendVerifyNum <= 1) {
                                        sendVerifyNum = 0;
                                        $("#btnSendVerify_pwd").html("获取验证码");
                                        $("#btnSendVerify_pwd").disabled = "";
                                        clearInterval(that.timer);
                                    }
                                }, 1000);
                            } else {
                                layer.alert(jsonData.Msg, { icon: 2 });
                            }
                           
                        }
                    });
                } else {
                    layer.alert('验证码已发到您手机，请查收！', { icon: 2 });
                }
            } else {
                //手机验证           
                var Phone = $.trim($("#txtPhone").val());
                if (Phone == null || Phone == "" || Phone == undefined) {
                    layer.alert('手机号码不能为空！', { icon: 2 });
                    //$("#txtPhone").focus();
                    return;
                }
                if (sendVerifyNum == 0) {
                    $.ajax({
                        type: "POST",
                        url: "/Home/PhoneCode",
                        data: {
                            "phone": Phone
                        },
                        dataType: "json",
                        success: function (jsonData) {
                            if (jsonData.Statu == 1) {
                                $("#btnSendVerify").disabled = "disabled";
                                sendVerifyNum = 59;
                                var that = this;
                                //计时器
                                that.timer = setInterval(function () {
                                    sendVerifyNum--;
                                    $("#btnSendVerify").html("( " + sendVerifyNum + " )");
                                    if (sendVerifyNum <= 1) {
                                        sendVerifyNum = 0;
                                        $("#btnSendVerify").html("获取验证码");
                                        $("#btnSendVerify").disabled = "";
                                        clearInterval(that.timer);
                                    }
                                }, 1000);
                            } else {
                                layer.alert(jsonData.Msg, { icon: 2 });
                            }
                        }
                    });
                } else {
                    layer.alert('验证码已发到您手机，请查收！', { icon: 2 });
                }
            }
           


        }

        //注册
        function registerin() {

            var txtPhone = $.trim($("#txtPhone").val());
            var txtUserPwd = $.trim($("#newpwd").val());
            var txtNick = $.trim($("#txtNick").val());
            var txtValidCode = $.trim($("#txtValidCode").val());
            var checkedpwd = $.trim($("#checkedpwd").val());
            if (txtValidCode == "" || txtValidCode == undefined) {
                layer.alert('验证码不能为空', { skin: 'layui-layer-lan' });
                return;
            }
            if (checkedpwd != txtUserPwd) {
                layer.alert('密码不一致', { skin: 'layui-layer-lan' });
                return;
            }
            //注册数据交互
            $.ajax({
                type: "POST",
                url: "/Home/RegisterIn",
                data: {
                    "txtPhone": txtPhone,
                    "txtUserPwd": txtUserPwd,
                    "txtNick": txtNick,
                    "txtValidCode": txtValidCode
                },
                dataType: "json",
                success: function (jsonData) {

                    if (jsonData.Statu == 1) {
                        location.href = jsonData.BackUrl;
                    } else {
                        layer.alert(jsonData.Msg, { skin: 'layui-layer-lan' });
                    }
                }
            });
        }

        //密码重置
        function resetpwd() {
            var txtPhone = $.trim($("#txtTel").val());
            var txtUserPwd = $.trim($("#Setpwd").val());           
            var txtValidCode = $.trim($("#txtCodePwd").val());
            //重置密码数据交互
            $.ajax({
                type: "POST",
                url: "/Home/ResetPwd",
                data: {
                    "txtPhone": txtPhone,
                    "txtUserPwd": txtUserPwd,                  
                    "txtValidCode": txtValidCode
                },
                dataType: "json",
                success: function (jsonData) {

                    if (jsonData.Statu == 1) {
                        location.href = jsonData.BackUrl;
                    } else {
                        layer.alert(jsonData.Msg, { skin: 'layui-layer-lan' });
                    }
                }
            });
        }
        //用户隐私条款
        function GetTerms() {
            //加载层-风格3
            parent.layer.load(1, { shade: false });
            layer.open({
                type: 2,
                skin: 'Withdraw-class', //加上边框
                title: '用户隐私条款',
                shadeClose: true,
                shade: 0.5,
                scrollbar: false,
                cancel: function (index, layero) {
                    layer.close(index)
                    return false;
                },
                area: ['60%', '85%'],
                content: ['/Home/Terms/'] //iframe的url no是不显示滚动条
            });
            //此处演示关闭
            setTimeout(function () {
                parent.layer.closeAll('loading');
            }, 1000);
        }

    </script>



</body>

</html>

